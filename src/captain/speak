#!/bin/bash
# speak â€” Send text to the voice interface for TTS playback
# Usage: speak "Workers are finishing up the auth module"

if [ -z "$1" ]; then
  echo "Usage: speak \"text to speak\"" >&2
  exit 1
fi

SPEAK_SOCKET="${SPEAK_SOCKET_PATH:-/run/squad-sockets/speak.sock}"
if [ ! -S "$SPEAK_SOCKET" ]; then
  echo "Error: speak socket not available at $SPEAK_SOCKET" >&2
  exit 1
fi

curl --silent --show-error --fail --unix-socket "$SPEAK_SOCKET" \
  -X POST "http://localhost/speak" \
  -H "Content-Type: application/json" \
  -d "{\"text\": $(printf '%s' "$1" | jq -Rs .)}" \
  > /dev/null
