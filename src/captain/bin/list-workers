#!/bin/bash
# list-workers â€” List active worker sessions on the workspace tmux server
# Usage: list-workers

set -euo pipefail

SOCKET="${WORKSPACE_TMUX_SOCKET:?WORKSPACE_TMUX_SOCKET not set}"

WORKERS=$(
    tmux -S "$SOCKET" list-panes -a -F '#{session_name} #{window_index} #{pane_current_command}' 2>/dev/null \
    | awk '$2 == "0" && ($3 == "claude" || $3 == "codex" || $3 == "node" || $3 == "npm") { print $1 }'
)

if [ -n "$WORKERS" ]; then
    echo "$WORKERS"
else
    echo "(no workers)"
fi
