#!/bin/bash
# capture-worker-output â€” Capture recent output from a worker pane
# Usage: capture-worker-output TASK_NAME [LINE_COUNT]

set -euo pipefail

TASK_NAME="${1:?Usage: capture-worker-output TASK_NAME [LINE_COUNT]}"
LINE_COUNT="${2:-50}"

SOCKET="${WORKSPACE_TMUX_SOCKET:?WORKSPACE_TMUX_SOCKET not set}"

# Find pane by window name
PANE_ID=$(tmux -S "$SOCKET" list-panes -a -F '#{window_name} #{pane_id}' 2>/dev/null | grep "^${TASK_NAME} " | head -1 | awk '{print $2}')

if [ -z "$PANE_ID" ]; then
    echo "ERROR: No worker found with name '$TASK_NAME'" >&2
    exit 1
fi

tmux -S "$SOCKET" capture-pane -t "$PANE_ID" -p -S "-${LINE_COUNT}"
